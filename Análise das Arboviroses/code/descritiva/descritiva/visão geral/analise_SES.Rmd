---
word_document:
  html_document:
    code_folding: hide
    highlight: tango
    lib_dir: libs
    number_sections: yes
    theme: yeti
    toc: yes
    toc_float:
      collapse: yes
date: "`r Sys.Date()`"
title: "Analise dos municipios 2016-2019 por Porte, IDH e Tipo"
output:
  html_document:
    df_print: paged
  word_document: default
editor_options:
  markdown:
    wrap: 72
---

```{r setup,include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, comment = '', warning = FALSE)
```

```{r}
library(data.table)
library(tidyverse)
library(read.dbc)
library(foreign)
library(dplyr)
require("stringr")
require(summarytools)
library(rapportools)
source("http://pcwww.liv.ac.uk/~william/R/crosstab.r")
```

<!-- # Leitura da base -->

```{r}
library(tibble)
library(readxl)
```

```{r}
load("/cloud/project/binomial/bases finais/bahia_pop_long.RData")
load("/cloud/project/binomial/bases finais/SNIS_ba.RData")
load("/cloud/project/binomial/bases finais/cadu_ba_16_19_12.RData")
```


```{r}
#https://cran.r-project.org/web/packages/expss/vignettes/tables-with-labels.html
library(expss)
mt = apply_labels(bahia_pop_long,
                      mun = "Municipio da Bahia",
                      ano = "Ano",
                      dg_incidencia_conf = "Tx incidencia Dengue",
                      chik_incidencia_conf = "Tx incidencia Chikungunya",
                      zk_incidencia_conf = "Tx incidencia Zika",
                      PIB_percapita = "Pib percapita",
                      dg_taxa_susp = "Tx suspeito Dengue",
                      chik_taxa_susp = "Tx suspeito Chikungunya",
                      zk_taxa_susp = "Tx suspeito Zika",
                      newtipology="Tipo do Município", 
                      newtipology=c("intermediarioadjacente" = 1, "intermediarioremoto" = 2, 
                                    "ruraladjacente" = 3, "ruralremoto" = 4, "urbano" = 5),
                      dens_mean = "densidade media",
                      bioma_2014 = "Uso do Solo",
                      bioma_2014 = c("floresta"=1, "natural não florestal"=2,"Agropecuária"=3,
                                     "Area não vegetada"=4, "corpos d’água"=5),
                      fluxo_2016 = "Deslocamento em 2016",
                      grupo_SES_CRI_2014 = "Desenvolvimento Regiao de Saude",
                      grupo_SES_CRI_2014 = c("Baixo desenvolvimento e oferta de serviços"=1, "Médio/alto desenvolvimento e baixa oferta (e/ou média/alta) de serviços"=2, "Médio desenvolvimento e média/alta oferta de serviços"=3, "Alto desenvolvimentoe média/alta oferta de serviços"= 4, "Alto desenvolvimento e alta oferta de serviços"=5),
                      percent_ab ="tx cobertura atencao básica por habitante" ,
                      tx_G12A = "tx scobertura agua por habitante",
                      tx_G12B = "tx scobertura esgoto por habitante",
                      IDH_2010 = "indice desenvolvimento humando 2010",
                      semiarido="Clima semi arido",
                      semiarido= c("Semiarido"= 1,"Nao arido"=0),
                      regiao.de.saude = "Regiao de Saude do municipio",
                      macrorregiao = "Macro regiao do municipio",
                      popporte = "Porte do municipio por habitante",
                      idhm="indice desenvolvimento humando 2015",
                      renda_gini="renda gini de 2015",
                      desemprego="desemprego em 2015",
                      pobres="pop pobre em 2015",
                      extr_pobres= "extpop pobre em 2015",
                      cobertbf="cobertura bf em 2015",
                      vacina="cobertura vacina febre amarela",
                      cadu_Ssnis_2015="inscritos no cadu sem agua, esgoto e lixo em 2015",
                      pop="densidade populacional municipal",
                      dg_auto="taxa de casos de dengue autoctone por habitante",
                      chik_auto="taxa de casos de chikungunya autoctone por habitante",
                      zk_auto="taxa de casos de zika autoctone por habitante"
)
#cross_cases(distribuicao, regiao.de.saude, pop)
```

# Porte dos municipios

Segundo o IBGE, o porte do município é aferido pelo tamanho da população. 
Municípios de pequenho porte I têm população abaixo de 20 mil habitantes, aqueles cuja a faixa populacional está entre 20 e 50 mil habitantes são classificados como de Pequeno Porte II. Municípios entre 50 e 100 mil habitantes são classificados como de Médio Porte. Os municípios de grande porte tem população entre 100 e 900 mil habitantes. A população nas metrópoles deve ultrapassar os 900 mil habitantes.


A maior parte dos municípios da Bahia são de Pequeno Porte (89,93%) donde 249 municípios são de Pequeno Porte I e 126 de Pequeno Porte II. 26 munícipios são de Médio Porte, ou seja tem população entre 50 e 100 mil habitantes, 15 de grande porte e 1 métropole, que é Salvador.


```{r}
library(sur)
porte<-table(mt[mt$ano==2019,]$popporte)
pie(porte)

```

```{r}
percent_porte<-percent.table(mt[mt$ano==2019,]$popporte, y = NULL)
percent_porte

```

Pie percen
```{r}
#pie(percent_porte,explode = 0.1)

porte<-as.data.frame(percent_porte)%>%dplyr::rename(Porte=x,Percentual=Freq)
library(ggplot2)
# Barplot
bp<- ggplot(porte, aes(x="Porte dos Municipios", y=Percentual, fill=Porte))+
geom_bar(width = 1, stat = "identity")
bp
```


# Municipios por RS
```{r}
mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(regiao.de.saude)%>%
 group_by(regiao.de.saude)%>%
  count()%>%
 # dplyr::rename(Regiao=regiao.de.saude)%>%
#  sort_desc(Total)%>%
  knitr::kable(.,"simple")

```

# Municipios por macrorregiao
```{r}
mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(macrorregiao)%>%
 group_by(macrorregiao)%>%
  count()%>%
 # dplyr::rename(Regiao=regiao.de.saude)%>%
#  sort_desc(Total)%>%
  knitr::kable(.,"simple")

```

municipio x macro x rs
```{r}
mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(macrorregiao, regiao.de.saude)%>%
 group_by(macrorregiao,regiao.de.saude)%>%
  count()%>%
 # dplyr::rename(Regiao=regiao.de.saude)%>%
  sort_desc(macrorregiao)%>%
  knitr::kable(.,"simple")

```

macrorregiao,regiao.de.saude, area, pop

```{r}
dado<-mt%>% dplyr::filter(ano==2019)%>%dplyr::select(macrorregiao,regiao.de.saude, area, pop)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  dplyr::summarise_at(c("area", "pop"), sum, na.rm = TRUE)%>%
  sort_desc(macrorregiao)

#write.csv()
dado%>%
  knitr::kable(.,"simple")

```

```{r}
library(dplyr)
library(tidyr)
library(viridis)

# The diamonds dataset is natively available with R.

# Without transparency (left)
p1 <- ggplot(data=dado, aes(x=pop, group=macrorregiao, fill=macrorregiao)) +
    geom_density(adjust=1.5) # +    theme_ipsum()
p1

# With transparency (right)
p2 <- ggplot(data=dado, aes(x=area, group=macrorregiao, fill=macrorregiao)) +
    geom_density(adjust=1.5, alpha=.4) #+    theme_ipsum()
p2
```


```{r}
library(ggplot2)

ggplot(dado, aes(x = macrorregiao, y = area)) +
  geom_bar(stat = "identity")
```

```{r}
library(ggplot2)

ggplot(dado, aes(x = macrorregiao, y = pop)) +
  geom_bar(stat = "identity")
```

```{r}
ggplot(dado, aes(x = area , y = regiao.de.saude)) +
  geom_bar(stat = "identity")

```


```{r}
ggplot(dado, aes(x = pop , y = regiao.de.saude)) +
  geom_bar(stat = "identity")
```

```{r}
#library(tidyverse)
#dado %>%
#  ggplot( aes(x=reorder(area_km, regiao.de.saude), y=regiao.de.saude, fill=area_km)) + 
#    geom_boxplot() +
#    xlab("area_km") +
#    theme(legend.position="none")

```

```{r}
library(hrbrthemes)
p2<-dado%>%
ggplot( aes(x=regiao.de.saude, y=pop) ) +
    geom_segment( aes(x=regiao.de.saude ,xend=regiao.de.saude, y=0, yend=pop), color="grey") +
    geom_point(size=3, color=rgb(0.7,0.2,0.1,0.8)) +
    coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("")

p1<-dado%>%
#  mutate(dens_mean=as.factor(dens_mean)) %>%
ggplot( aes(x=regiao.de.saude, y=area) ) +
    geom_segment( aes(x=regiao.de.saude ,xend=regiao.de.saude, y=0, yend=area), color="grey") +
    geom_point(size=3, color="#69b3a2") +
    coord_flip() +
    theme_ipsum() +
    theme(
      panel.grid.minor.y = element_blank(),
      panel.grid.major.y = element_blank(),
      legend.position="none"
    ) +
    xlab("")


```

```{r}
p1
```


```{r}
p2
```

```{r}
ggplot(dado) +
  geom_segment( aes(x=regiao.de.saude, xend=regiao.de.saude, y=area, yend=pop), color="grey") +
  geom_point( aes(x=regiao.de.saude, y=area), color=rgb(0.2,0.7,0.1,0.8), size=3 ) +
  geom_point( aes(x=regiao.de.saude, y=pop), color=rgb(0.7,0.2,0.1,0.8), size=3 ) +
  coord_flip()+
  theme_ipsum() +
  theme(
    legend.position = "none",
    panel.border = element_blank(),
  ) +
  xlab("") +
  ylab("area_km")
```


## RS por area e densidade média populacional para período 4 anos

```{r}
mt%>% dplyr::select(regiao.de.saude, area, pop)%>%
  group_by(regiao.de.saude)%>%
  dplyr::summarise_at(c("area", "pop"), sum, na.rm = TRUE)%>%
  sort_desc(area,pop)%>%
  knitr::kable(.,"simple")
```
## RS por porte
```{r}
dado<-mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(regiao.de.saude,popporte)%>%
 group_by(regiao.de.saude,popporte)%>%
  count()

names(dado)<-c("regiao.de.saude","popporte","municipios")

p3<-dado%>%
  ggplot( aes(x=municipios, y=regiao.de.saude, fill=popporte)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("regiao.de.saude")+
    xlab("municipios")

dado2<-mt%>% dplyr::filter(ano==2019)%>%
    dplyr::select(macrorregiao,popporte)%>%
 group_by(macrorregiao,popporte)%>%
  count()

names(dado2)<-c("macrorregiao","popporte","municipios")

p4<-dado2%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=municipios, y=macrorregiao, fill=popporte)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("macrorregiao")+
    xlab("municipios")
```


```{r}
# Open a pdf file

png(filename="/cloud/project/binomial/bases finais/porte_regiao.png")
plot(p3)
dev.off();

png(filename="/cloud/project/binomial/bases finais/porte_macror.png")
plot(p4)
dev.off();

```
## RS por porte, area e densidade
```{r}
mt%>% 
  dplyr::select(regiao.de.saude,popporte,area, pop)%>%
 group_by(regiao.de.saude,popporte)%>%
 dplyr::summarise_at(c("area","pop"), sum, na.rm = TRUE)%>%
  sort_desc(area,pop)%>%
  knitr::kable(.,"simple")
```
## RS por desenvolvimento 

```{r}
table(mt[mt$ano==2019,]$grupo_SES_CRI_2014)
```

```{r}
mt %>% dplyr::filter(ano==2019)%>%
  mutate(grupo_SES_CRI_2014 = case_when(
         grupo_SES_CRI_2014 == 1 ~ 'Baixo desenvolvimento e oferta de serviços',
         grupo_SES_CRI_2014 == 2 ~ 'Médio/alto desenvolvimento e baixa oferta (e/ou média/alta) de serviços', 
         grupo_SES_CRI_2014 == 3 ~ 'Médio desenvolvimento e média/alta oferta de serviços', 
         grupo_SES_CRI_2014 == 4 ~ 'Alto desenvolvimentoe média/alta oferta de serviços',
         grupo_SES_CRI_2014 == 5 ~ 'Alto desenvolvimento e alta oferta de serviços')) %>%
  dplyr::select(regiao.de.saude,grupo_SES_CRI_2014)%>%
 group_by(regiao.de.saude,grupo_SES_CRI_2014)%>%
  count()%>%
#  dplyr::rename(Regiao=regiao.de.saude, Porte=popporte, Municipios=freq)%>%
  knitr::kable(.,"simple")



```
```{r}
mt %>% dplyr::filter(ano==2019)%>%
  mutate(grupo_SES_CRI_2014 = case_when(
         grupo_SES_CRI_2014 == 1 ~ 'Baixo desenvolvimento e oferta de serviços',
         grupo_SES_CRI_2014 == 2 ~ 'Médio/alto desenvolvimento e baixa oferta (e/ou média/alta) de serviços', 
         grupo_SES_CRI_2014 == 3 ~ 'Médio desenvolvimento e média/alta oferta de serviços', 
         grupo_SES_CRI_2014 == 4 ~ 'Alto desenvolvimentoe média/alta oferta de serviços',
         grupo_SES_CRI_2014 == 5 ~ 'Alto desenvolvimento e alta oferta de serviços')) %>%
         mutate(IDH = case_when(
                               IDH_2015 < 0.5 ~ 'MUITO BAIXO',
                               IDH_2015>=0.5 & IDH_2015<0.6 ~ 'BAIXO', 
                               IDH_2015>=0.6 & IDH_2015<0.7 ~ 'MEDIO', 
                               IDH_2015>=0.7 & IDH_2015<0.8 ~ 'ALTO',
                               IDH_2015 >=0.8 ~ 'MUITO ALTO')) %>%
  dplyr::select(regiao.de.saude,IDH,grupo_SES_CRI_2014)%>%
 group_by(regiao.de.saude, IDH,grupo_SES_CRI_2014)%>%
  count()%>%
#  dplyr::rename(Regiao=regiao.de.saude, Porte=popporte, Municipios=freq)%>%
  knitr::kable(.,"simple")

```
Macrorregiao por porte 

```{r}
mt%>% 
  dplyr::select(macrorregiao,popporte)%>%
 group_by(macrorregiao,popporte)%>%
  count()%>%
 sort_desc(macrorregiao)%>%
  knitr::kable(.,"simple")

```

```{r}
data<-mt%>% 
  dplyr::select(macrorregiao,regiao.de.saude, popporte,area, pop)%>%
 group_by(macrorregiao,regiao.de.saude,popporte)%>%
 dplyr::summarise_at(c("area","pop"), sum, na.rm = TRUE)%>%
  sort_desc(macrorregiao)

data%>%
  knitr::kable(.,"simple")

```
```{r}
#data$popporte[data$popporte=="Metr?ole"]<-"Metropole"

data  %>% 
  ggplot( aes(x=macrorregiao, y=area, fill=popporte)) +
    geom_bar(stat="identity", position="stack",width = 0.5) +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("Área Km2")+
    theme(axis.text.x=element_text(size=8)#,axis.text.y = element_text(size=12)
        )
```
```{r}
#data$popporte[data$popporte=="Metr?ole"]<-"Metropole"
data  %>% 
  ggplot( aes(x=macrorregiao, y=pop, fill=popporte)) +
    geom_bar(stat="identity", position="stack",width = 0.5) +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("Densidade Média")+
    theme(axis.text.x=element_text(size=8)#,axis.text.y = element_text(size=12)
        )
```


```{r}
#data$popporte[data$popporte=="Metr?ole"]<-"Metropole"
data  %>% 
  ggplot( aes(x=area, y=regiao.de.saude, fill=popporte)) +
    geom_bar(stat="identity", position="stack",width = 0.5) +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("Região de saúde")+
    theme(axis.text.y=element_text(size=8)#,axis.text.y = element_text(size=12)
        )

```
```{r}
#data$popporte[data$popporte=="Metr?ole"]<-"Metropole"
data  %>% 
  ggplot( aes(x=pop, y=regiao.de.saude, fill=popporte)) +
    geom_bar(stat="identity", position="stack",width = 0.5) +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("Região de saúde")+
    theme(axis.text.y=element_text(size=8)#,axis.text.y = element_text(size=12)
        )
```

```{r}
ggplot(data, aes(x=pop, y=regiao.de.saude, color=macrorregiao, shape=popporte,
                 group=interaction(macrorregiao,regiao.de.saude))) + 
  geom_point(size=3) +
  geom_line()
```


## Macroregiao por porte, area e densidade média pop 4 anos


```{r}
mt%>% 
  dplyr::select(macrorregiao,popporte,area, pop)%>%
 group_by(macrorregiao,popporte)%>%
 dplyr::summarise_at(c("area","pop"), sum, na.rm = TRUE)%>%
  sort_desc(area,pop)%>%
  knitr::kable(.,"simple")
```

# IDH 

O valor do IDH nos municípios bahianos varia entre 0.5735 e 0.8230, com média de 0.6769 e valor médio de 0.6725, conforme indica o resumo sumário da variável: 

```{r}
summary(mt[mt$ano==2019,]$IDH_2015)
```
O Índice de Desenvolvimento Humano (IDH) é uma medida geral e sintética usada para classificar o grau de desenvolvimento econômico e a qualidade de vida dos países. Foi criado em 1990 e vem sendo publicado anualmente desde 1993 pelo Programa das Nações Unidas para o Desenvolvimento – PNUD da ONU. O IDH varia em uma escala que vai de 0 a 1. Quanto mais próximo de 1, maior o desenvolvimento humano. A escala classifica os países em cinco faixas: IDH muito alto, alto, médio, baixo e muito baixo, conforme o intervalos abaixo:

< 0,50: Muito Baixo
0,5 - 0,599: Baixo
0,6 - 0,699: Medio
0,7 - 0,799: Alto
>= 0,800: Muito Alto

```{r}
mt = mt %>% dplyr::filter(ano==2019)%>% mutate(IDH = case_when(
                               IDH_2015 < 0.5 ~ 'MUITO BAIXO',
                               IDH_2015>=0.5 & IDH_2015<0.6 ~ 'BAIXO', 
                               IDH_2015>=0.6 & IDH_2015<0.7 ~ 'MEDIO', 
                               IDH_2015>=0.7 & IDH_2015<0.8 ~ 'ALTO',
                               IDH_2015 >=0.8 ~ 'MUITO ALTO'))

```

Os municípios baiano tem de médio a alto desenvolvimento: 76,50% dos municípios baianos tem desenvolvimento médio enquanto que 22% apresentam IDH alto. Os municipios de IBIQUERA(IDH= 0.5825),ITAPICURU (IDH= 0.5735),LAMARAO (IDH=0.5820) e MACAJUBA(IDH=0.5990) são os que apresentam baixo desenvolvimento. IBIQUERA e MACAJUBA estão na Regiao de Itaberaba, enquanto que ITAPICURU e LAMARAO são municípios de Alagoinhas e Serrinha, respectivamente. São da região de Salvador os municípios com alto índice de IDH: LAURO DE FREITAS (IDH=0.8230) e SALVADOR (IDH=0.8115).

```{r}
library(ggplot2)

dado2<-mt%>% 
    dplyr::select(macrorregiao,IDH)%>%
 group_by(macrorregiao,IDH)%>%
  count()

names(dado2)<-c("macrorregiao","IDH","municipios")

p5<-dado2%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=municipios, y=macrorregiao, fill=IDH)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("macrorregiao")+
    xlab("municipios")
```

```{r}
png(filename="/cloud/project/binomial/bases finais/IDH_macror.png")
plot(p5)
dev.off();
```

```{r}
library(ggplot2)

dado2<-mt%>% 
    dplyr::select(regiao.de.saude,IDH)%>%
 group_by(regiao.de.saude,IDH)%>%
  count()

names(dado2)<-c("regiao.de.saude","IDH","municipios")

p6<-dado2%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=municipios, y=regiao.de.saude, fill=IDH)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("regiao de saude")+
    xlab("municipios")


```

```{r}
png(filename="/cloud/project/binomial/bases finais/IDH_regiao.png")
plot(p6)
dev.off();
```

```{r}
mt%>% dplyr::filter(ano==2019 & IDH=="BAIXO")%>%
  dplyr::arrange(IDH_2015)%>%
  dplyr::select(macrorregiao,regiao.de.saude, mun, IDH_2015)

```
Municipio com alto IDH
```{r}
mt%>% dplyr::filter(ano==2019 & IDH=="MUITO ALTO")%>%
  dplyr::arrange(IDH_2015)%>%
  dplyr::select(macrorregiao,regiao.de.saude, mun, IDH_2015)
 
  
```
## IDH por porte
```{r}
idh_porte<-mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(popporte,IDH)%>%
 group_by(popporte,IDH)%>%
  count()#%>%
#  dplyr::rename(Porte=popporte, IDH=IDH, Municipios=freq)%>%
  
idh_porte%>%knitr::kable(.,"simple")

```
# Tipologia



```{r}
table(mt[mt$ano==2019,]$newtipology)
```
```{r}
percent.table(mt[mt$ano==2019,]$newtipology, y = NULL)
```

```{r}
mt%>% 
  dplyr::filter(ano==2019)%>%
  dplyr::select(macrorregiao,regiao.de.saude,tipologia)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  count()%>%
  knitr::kable(.,"simple")

```



```{r}
mt%>% dplyr::filter(ano==2019)%>%dplyr::mutate(newtipology = case_when(
                              newtipology== 1 ~ 'Intermediario Adjacente',
                              newtipology== 2 ~ 'Intermediario Remoto', 
                              newtipology== 3 ~ 'Rural Adjacente', 
                              newtipology== 4 ~ 'Rural Remoto',
                              newtipology== 5 ~ 'Urbano'))%>%
  dplyr::filter(ano==2019)%>% 
  dplyr::select(popporte,newtipology)%>%
  group_by(popporte,newtipology)%>%
  count()%>%
#  dplyr::rename(Porte =popporte, Tipo=newtipology, Municipios=freq)%>%
  knitr::kable(.,"simple")

```


```{r}

tipo<-mt%>% dplyr::filter(ano==2019)%>% dplyr::mutate(newtipology = case_when(
                              newtipology== 1 ~ 'Intermediario Adjacente',
                              newtipology== 2 ~ 'Intermediario Remoto', 
                              newtipology== 3 ~ 'Rural Adjacente', 
                              newtipology== 4 ~ 'Rural Remoto',
                              newtipology== 5 ~ 'Urbano'))%>%
  dplyr::select(macrorregiao,regiao.de.saude,newtipology, area, pop)%>%
  group_by(macrorregiao,regiao.de.saude,newtipology )%>%
  dplyr::summarise_at(c("area", "pop"), sum, na.rm = TRUE)%>%
  sort_desc(macrorregiao)

tipo%>%
  knitr::kable(.,"simple")

```


```{r}
library(ggplot2)

p7<-tipo%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=area, y=macrorregiao, fill=newtipology)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("macrorregiao")+
    xlab("area km2 ")
```

```{r}
p7
```

```{r}
png(filename="/cloud/project/binomial/bases finais/tipo_area_macror.png")
plot(p7)
dev.off();
```


```{r}
library(ggplot2)

p8<-tipo%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=pop, y=macrorregiao, fill=newtipology)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("macrorregiao")+
    xlab("densidade populacional")
```

```{r}
p8
```

```{r}
png(filename="/cloud/project/binomial/bases finais/tipo_pop_macror.png")
plot(p8)
dev.off();
```

```{r}
library(ggplot2)

p9<-tipo%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=area, y=regiao.de.saude, fill=newtipology)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("Regiao de Saude")+
    xlab("area km2")
```

```{r}
p9
```

```{r}
png(filename="/cloud/project/binomial/bases finais/tipo_area_regiao.png")
plot(p9)
dev.off();
```
```{r}
library(ggplot2)

p10<-tipo%>%
  #dplyr::rename("municipios"=freq)%>%
  ggplot( aes(x=pop, y=regiao.de.saude, fill=newtipology)) +
    geom_bar(stat="identity", position="stack") +
    scale_fill_viridis(discrete=TRUE, name="") +
    theme_ipsum() +
    ylab("regiao de saude")+
    xlab("densidade populacional")
```

```{r}
p10
```

```{r}
png(filename="/cloud/project/binomial/bases finais/tipo_pop_regiao.png")
plot(p10)
dev.off();
```

```{r}
png("/cloud/project/binomial/bases finais/tipologia.png", width=800, height=600, units="px")
par(mfrow = c(2,2), oma = c(4,1,1,1))
plot(p7, main="Gráfico 1")
plot(p8, main="Gráfico 2")
plot(p9, main="Gráfico 3")
plot(p10, main="Gráfico 4")
dev.off();
```

```{r}
ggplot(tipo, aes(area, pop, fill = newtipology)) +
  geom_bar(stat="identity", position = "dodge") + 
  labs(title="Multiple Bar plots")
```

```{r}
ggplot(tipo, aes(x=pop, y=regiao.de.saude, color=macrorregiao, shape=newtipology,
                 group=interaction(macrorregiao,regiao.de.saude))) + 
  geom_point(size=3) +
  geom_line()
```
```{r}
tipo %>% 
#  group_by(continent, year) %>% 
#  summarise(life_expec_media = mean(life_expec)) %>% 
  ggplot(aes(x = newtipology, y = pop, fill = area)) +
  geom_col(stat="identity",position = "dodge")+
#  scale_fill_continuous (values = c("LightGreen","darkorange","brown1","cornflowerblue"))+
  theme_minimal()+
  theme(axis.text.x=element_text(size=8),
        axis.text.y = element_text(size=12)
        )
```


```{r}
tipo2<-mt%>% dplyr::filter(ano==2019)%>%
  dplyr::select(macrorregiao,regiao.de.saude,IDH)%>%
 group_by(macrorregiao,regiao.de.saude,IDH)%>%
  count()

tipo2%>%
#  dplyr::rename(Regiao=regiao.de.saude, IDH=IDH, Municipios=freq)%>%
  knitr::kable(.,"simple")

```

```{r}
names(tipo2)<-c("macrorregiao","regiao.de.saude","IDH","municipios")
tipo2%>%
#   ggplot(aes(freq,interaction(regiao.de.saude,IDH)))+
#   geom_point(aes(colour = macrorregiao, size = 2))
#  dplyr::rename('municipios'=freq)%>%
  ggplot(aes(x=macrorregiao, y=regiao.de.saude, colour=IDH, size=municipios, #shape = macrorregiao,
  group=interaction(regiao.de.saude,IDH))) + 
  geom_point() + geom_line()
```


```{r}
ggplot(tipo2, aes(x = macrorregiao, y = regiao.de.saude, color = IDH)) +
  geom_jitter(width = .2)
```



```{r}
#df <- melt(tipo ,  id =c("freq"), variable.name = 'series')
#create line plot for each column in data frame
#ggplot(df, aes(freq, value)) +
#  geom_line(aes(colour = series))
#group=interaction(IDH, macrorregiao)
ggplot(tipo2, aes(x=municipios, y=regiao.de.saude, color=macrorregiao, shape=IDH,
                 group=interaction(macrorregiao,regiao.de.saude))) + 
  geom_point(size=3) +
  geom_line()

```

# Semiarido

```{r}
table(mt[mt$ano==2019,]$semiarido)
```

```{r}
library(sur)
arido<-table(mt[mt$ano==2019,]$semiarido)
pie(arido)
```

### RS por seca

```{r}
semiarido<-mt%>% dplyr::filter(ano==2019)%>%
  dplyr::mutate(semiarido = case_when(
                              semiarido== 0 ~ 'não seca',
                              semiarido== 1 ~ 'seca'))%>%
dplyr::select(macrorregiao,regiao.de.saude,semiarido)%>%
 group_by(macrorregiao,regiao.de.saude,semiarido)%>%
  count()

semiarido %>%
#  dplyr::rename(Regiao=regiao.de.saude, IDH=IDH, Municipios=freq)%>%
  knitr::kable(.,"simple")

```


```{r}
p=semiarido%>% dplyr::filter(semiarido=="seca")%>%
 ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = freq)) +
  geom_point()
  #theme(axis.text.y = element_text(size = 2))

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/seca.jpg")

```

```{r}
p=semiarido%>% dplyr::filter(semiarido!="seca")%>%
 ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = freq)) +
  geom_point()
  #theme(axis.text.y = element_text(size = 2))

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/naoseca.jpg")

```

# PIB


```{r}
load("/cloud/project/binomial/bases finais/base_analise_ha.RData")
library(reshape2)

data_wide <- dcast(base_analise_ha, mun ~ ano, value.var="PIB_percapita")
names(data_wide)<- c("mun", "PIB_percapita_2016","PIB_percapita_2017","PIB_percapita_2018","PIB_percapita_2019")
```

```{r}
#Pib Percapita com summarySE
#a data frame with count, mean, standard deviation, standard error of the mean, and confidence interval (default 95%).

library(Rmisc)
summarySE(base_analise_ha, measurevar="PIB_percapita", groupvars=c("ano"))
```

```{r}
png(filename="/cloud/project/binomial/bases finais/PIB.png")
boxplot(data_wide %>% dplyr::select(PIB_percapita_2016,PIB_percapita_2017,PIB_percapita_2018,PIB_percapita_2019), names = 2016:2019)
dev.off();
```

```{r}
boxplot(data_wide %>% dplyr::select(PIB_percapita_2016,PIB_percapita_2017,PIB_percapita_2018,PIB_percapita_2019),  main = 'Evolução do PIB percapita dos municípios da Bahia, 2016 a 2019', names = 2016:2019)
```
##Graficos

```{r}
p<-base_analise_ha %>%dplyr::select(mun,PIB_percapita,ano)%>%
  left_join(bahia_pop_long %>%
  dplyr::select(mun,ano,macrorregiao, regiao.de.saude),by = c('mun' = 'mun','ano'='ano'))%>%
  #dplyr::mutate(semi.arido=as.factor(semiarido))%>%
  ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = PIB_percapita)) +
  geom_point()
  #theme(axis.text.y = element_text(size = 2))

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/PIB_regiao.jpg")

#,width=20,height=4,units = "cm"
```
 Histograma
 
```{r}
#png(filename="/cloud/project/binomial/bases finais/PIB_histogram.png")
dado<-dado%>%dplyr::arrange(PIB_percapita)
ggplot(dado, aes(x = macrorregiao, y = PIB_percapita)) +
  geom_bar(stat = "identity")
ggsave("/cloud/project/binomial/bases finais/PIB_histogram.jpg")
dev.off()
```
Mapa de calor por município
```{r}
library(tidyverse)
n_data_wide<-data_wide %>% remove_rownames %>% column_to_rownames(var="mun")%>%dplyr::select(-1)%>%as.matrix()

png(filename="/cloud/project/binomial/bases finais/mapacalor_PIB_mun.png")
heatmap(n_data_wide,Rowv = NA, Colv = NA, labCol= c("PIB 2016", "PIB 2017", "PIB 2018"),cexCol=0.8)
dev.off()


# save the file with exaggerated width (just an example)
#ggsave("/cloud/project/binomial/bases finais/PIB_regiao.jpg")

#data_melt<-melt(data_wide)  
#ggp <- ggplot(data_melt, aes(variable,mun)) +                           # Create heatmap with ggplot2
#  geom_tile(aes(fill = value))

#ggp  +
#theme_bw() + 
#  theme(axis.title = element_text(size = 10),
#        axis.text = element_text(size = 2))

  
```


```{r}
# Default Heatmap
heatmap(n_data_wide,Rowv = NA, Colv = NA, labCol= c("PIB 2016", "PIB 2017", "PIB 2018"),cexCol=0.8)

```


Mapa calor por Macroregião e RS



## Maiores PIBs

```{r}
# pega os maiores valores
#getmode <- function(v) {
#   uniqv <- unique(v)
#   uniqv[which.max(tabulate(match(v, uniqv)))]
#}

```


```{r}
result_2016 <- median(data_wide$PIB_percapita_2016)
result_2017 <- median(data_wide$PIB_percapita_2017)
result_2018 <- median(data_wide$PIB_percapita_2018)
result_2019 <- median(data_wide$PIB_percapita_2019)

maiores_pibs<-data_wide%>%dplyr::filter(PIB_percapita_2016>=result_2016 & PIB_percapita_2017>=result_2017 & PIB_percapita_2018>=result_2018 & PIB_percapita_2019>=result_2019)%>%
dplyr::arrange(mun)

maiores_pibs_2<-maiores_pibs %>%dplyr::select(mun)%>%
  left_join(base_analise_ha %>% 
  dplyr::select(mun,PIB_percapita,ano),by = c('mun'='mun'))%>%
  left_join(bahia_pop_long %>%
  dplyr::select(mun,ano,macrorregiao, regiao.de.saude),by = c('mun' = 'mun','ano'='ano'))

maiores_pibs_2%>%dplyr::filter(ano==2019)%>%dplyr::select(macrorregiao,regiao.de.saude,mun)%>%arrange(macrorregiao,regiao.de.saude,mun)%>%knitr::kable(.,"simple")

```
```{r}
dado<-maiores_pibs_2%>% dplyr::select(macrorregiao,regiao.de.saude, PIB_percapita)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita,macrorregiao,regiao.de.saude)

dado %>%knitr::kable(.,"simple")
```

```{r}
p<-dado%>%
  ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = PIB_percapita)) +
  geom_point()
  #theme(axis.text.y = element_text(size = 2))

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/MaxPIB_regiao.jpg")
```



```{r}
mp<-maiores_pibs_2%>% dplyr::select(macrorregiao,PIB_percapita)%>%
  group_by(macrorregiao)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita)

mp
```


```{r}
maiores_pibs_2%>% dplyr::select(regiao.de.saude,PIB_percapita)%>%
  group_by(regiao.de.saude)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita)

```

## Menores PIBs

```{r}
getmode_min <- function(v) {
   uniqv <- unique(v)
   uniqv[which.min(tabulate(match(v, uniqv)))]
}

```


```{r}
result_2016 <- getmode_min(data_wide$PIB_percapita_2016)
result_2017 <- getmode_min(data_wide$PIB_percapita_2017)
result_2018 <- getmode_min(data_wide$PIB_percapita_2018)
result_2019 <- getmode_min(data_wide$PIB_percapita_2019)

menores_pibs<-data_wide%>%dplyr::filter(PIB_percapita_2016>=result_2016 & PIB_percapita_2017>=result_2017 & PIB_percapita_2018>=result_2018 & PIB_percapita_2019>=result_2019)%>%
dplyr::arrange(mun)

menores_pibs_2<-menores_pibs %>%dplyr::select(mun)%>%
  left_join(base_analise_ha %>% 
  dplyr::select(mun,PIB_percapita,ano),by = c('mun'='mun'))%>%
  left_join(bahia_pop_long %>%
  dplyr::select(mun,ano,macrorregiao, regiao.de.saude),by = c('mun' = 'mun','ano'='ano'))

menores_pibs_2%>%dplyr::filter(ano==2019)%>%dplyr::select(macrorregiao,regiao.de.saude,mun)%>%arrange(macrorregiao,regiao.de.saude,mun)%>%knitr::kable(.,"simple")

```
```{r}
dado<-menores_pibs_2%>% dplyr::select(macrorregiao,regiao.de.saude, PIB_percapita)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita,macrorregiao,regiao.de.saude)

dado %>%knitr::kable(.,"simple")
```



```{r}
menores_pibs_2%>% dplyr::select(macrorregiao,PIB_percapita)%>%
  group_by(macrorregiao)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita)

```

```{r}
menores_pibs_2%>% dplyr::select(regiao.de.saude,PIB_percapita)%>%
  group_by(regiao.de.saude)%>%
  dplyr::summarise_at(c("PIB_percapita"), mean, na.rm = TRUE)%>%
  sort_desc(PIB_percapita)

```


```{r}
library(Rmisc)
summarySE(mt, measurevar="populacao", groupvars=c("ano"))

```

```{r}
mt%>% 
  dplyr::select(populacao,ano)%>%
 group_by(ano)%>%
 dplyr::summarise_at(c("populacao"), sum, na.rm = TRUE)%>%
  knitr::kable(.,"simple")
```

## Outliers das variáveis de densidade

```{r}
boxplot(mt %>%dplyr::select(pop), main = 'Densidade média dos municíos da Bahia')
```


_ area
```{r}
summary(mt$area)
```

- Por sua vez, o tamanho da população entre as cidades também apresenta outliers:


```{r}
boxplot(mt %>%dplyr::select(area), main = 'Área (km2) dos municíos da Bahia')
```

## Logo, ouliers já eram esperados nos valores das densidades e na média das densidades.

# Semi-arido

```{r}
table(mt$semiarido)
```

```{r}
tabela<-mt %>% dplyr::filter(ano==2019)%>%
  dplyr::select(macrorregiao,regiao.de.saude,semiarido)%>%
  group_by(macrorregiao,regiao.de.saude, semiarido)%>%
  count()

tabela%>%
#  ggplot(aes(macrorregiao,regiao.de.saude))+
  ggplot(aes(freq,interaction(regiao.de.saude,semiarido)))+
 #geom_line(aes(group = semi.arido))
  geom_point(aes(colour = factor(semiarido)), size = 3)

#tabela%>%
#ggplot(aes(macrorregiao,regiao.de.saude,group=semi.arido,color=as.factor(semi.arido))) + geom_point() 
#ggplot( aes(x=freq,interaction(regiao.de.saude,semi.arido)) )+
#  geom_jitter(aes(color=factor(semi.arido)))  
```







```{r}
mt %>%
  dplyr::mutate(semi.arido=as.factor(semiarido))%>%
  ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = semiarido)) +
  geom_point()
```
##Bioma
bioma_2014 = c("floresta"=1, "natural não florestal"=2,"Agropecuária"=3,
                                     "Area não vegetada"=4, "corpos d’água"=5)
                                     
```{r}
bioma<-mt%>%filter(ano==2019)%>%
  dplyr::mutate(bioma = case_when(
                              bioma_2014== 1 ~ 'floresta',
                              bioma_2014== 2 ~ 'natural não florestal', 
                              bioma_2014== 3 ~ 'Agropecuária', 
                              bioma_2014== 4 ~ 'Area não vegetada',
                              bioma_2014== 5 ~ 'corpos d’água'))%>%
   dplyr::select(mun,macrorregiao,regiao.de.saude,bioma)

bioma%>%
  dplyr::select(bioma)%>%
  table()
  #table(., .$bioma_2014)

```

```{r}
percent.table(bioma$bioma, y = NULL)
```


```{r}
p<-mt %>%
  filter(ano==2019)%>%
  dplyr::mutate(bioma = case_when(
                              bioma_2014== 1 ~ 'floresta',
                              bioma_2014== 2 ~ 'natural não florestal', 
                              bioma_2014== 3 ~ 'Agropecuária', 
                              bioma_2014== 4 ~ 'Area não vegetada',
                              bioma_2014== 5 ~ 'corpos d’água'))%>%
  ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size = bioma)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/bioma.jpg")

```






```{r}
tab<-mt %>%
  filter(ano==2019)%>%
  dplyr::mutate(bioma = case_when(
                              bioma_2014== 1 ~ 'floresta',
                              bioma_2014== 2 ~ 'natural não florestal', 
                              bioma_2014== 3 ~ 'Agropecuária', 
                              bioma_2014== 4 ~ 'Area não vegetada',
                              bioma_2014== 5 ~ 'corpos d’água'))%>%
  dplyr::select(macrorregiao,regiao.de.saude,bioma)%>%
  group_by(macrorregiao,regiao.de.saude,bioma)%>%
  count()%>%
  arrange(macrorregiao,regiao.de.saude,freq)

tab%>%
  knitr::kable(.,"simple")
```


```{r}
p<-tab%>%
ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             shape = bioma)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

```

```{r}
p<-tab%>%arrange(bioma)%>%
ggplot(aes(x = bioma, y = freq)) +
    geom_bar(stat = "identity")

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

ggsave("/cloud/project/binomial/bases finais/bioma_histogram.jpg")
dev.off();

```

```{r}
bioma_macro<-mt %>%
  filter(ano==2019)%>%
  dplyr::mutate(bioma = case_when(
                              bioma_2014== 1 ~ 'floresta',
                              bioma_2014== 2 ~ 'natural não florestal', 
                              bioma_2014== 3 ~ 'Agropecuária', 
                              bioma_2014== 4 ~ 'Area não vegetada',
                              bioma_2014== 5 ~ 'corpos d’água'))%>%
  dplyr::select(macrorregiao,bioma)%>%
  group_by(macrorregiao,bioma)%>%
  count()%>%
  arrange(macrorregiao,freq)

bioma_macro%>%
  knitr::kable(.,"simple")

```


```{r}
p<-bioma_macro %>% dplyr::rename(municipios=freq)%>%
  ggplot(aes(x = macrorregiao,
             y = bioma, 
             size = municipios)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/bioma_macro.jpg")

```


```{r}
bioma_macro%>%dplyr::rename(municipios=freq)%>%
 ggplot(aes(x = municipios,
             y = macrorregiao, 
             shape=bioma,
             size = municipios)) +
  geom_point()
```



```{r}
ggplot(tab, aes(x=freq, y=regiao.de.saude, color=macrorregiao, shape=bioma,
                 group=interaction(macrorregiao,regiao.de.saude))) + 
  geom_point(size=3) +
  geom_line()
```


# CADU

```{r}

cadu<-cadu_ba_16_19_12%>%dplyr::select(-1,-8,-9)%>%
  left_join(bahia_pop_long %>%
  dplyr::select(mun,ano,cadu_Ssnis_2015,regiao.de.saude,macrorregiao),by = c('mun' = 'mun','ano'='ano'))

```

```{r}
library(Rmisc)
summarySE(cadu, measurevar="cadunico_tot_fam", groupvars=c("ano"))

```
```{r}
library(Rmisc)
summarySE(cadu, measurevar="cadunico_tot_pes_pob_e_ext_pob", groupvars=c("ano"))

```

```{r}
library(Rmisc)
summarySE(cadu, measurevar="cadunico_tot_pes", groupvars=c("ano"))
```

```{r}
cadu%>% dplyr::select(populacao, cadunico_tot_fam, cadunico_tot_pes,cadunico_tot_pes_pob_e_ext_pob)%>%
  dplyr::summarise_at(c("populacao","cadunico_tot_fam", "cadunico_tot_pes","cadunico_tot_pes_pob_e_ext_pob"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  mutate(pes_cadu= round((cadunico_tot_pes/populacao)*100,3))%>% # por ha
  sort_desc(cadunico_tot_pes,cadunico_tot_pes_pob_e_ext_pob)

```

```{r}
aux<-cadu%>% dplyr::select(ano, populacao, cadunico_tot_fam, cadunico_tot_pes,cadunico_tot_pes_pob_e_ext_pob)%>%
  group_by(ano)%>%
  dplyr::summarise_at(c("populacao","cadunico_tot_fam", "cadunico_tot_pes","cadunico_tot_pes_pob_e_ext_pob"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  mutate(pes_cadu= round((cadunico_tot_pes/populacao)*100,3))%>% # por ha
  sort_desc(ano)

#write.csv()
aux%>%
  knitr::kable(.,"simple")
```


```{r}
p<-aux%>%
ggplot(aes(x = ano,
             y = pes_cadu, 
             size=percent_pob)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 4))
```

```{r}
aux<-cadu%>% dplyr::select(ano, macrorregiao,populacao, cadunico_tot_pes,cadunico_tot_pes_pob_e_ext_pob)%>%
  group_by(ano,macrorregiao)%>%
  dplyr::summarise_at(c("populacao", "cadunico_tot_pes","cadunico_tot_pes_pob_e_ext_pob"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  mutate(pes_cadu= round((cadunico_tot_pes/populacao)*100,3))%>% # por ha
  sort_desc(ano,macrorregiao)

#write.csv()
aux%>%
  knitr::kable(.,"simple")

```

```{r}
dado<-cadu%>% dplyr::select(macrorregiao,regiao.de.saude, ano, cadunico_tot_fam, cadunico_tot_pes,cadunico_tot_pes_pob_e_ext_pob)%>%
  group_by(macrorregiao,regiao.de.saude,ano)%>%
  dplyr::summarise_at(c("cadunico_tot_fam", "cadunico_tot_pes","cadunico_tot_pes_pob_e_ext_pob"), sum, na.rm = TRUE)%>%
  sort_desc(macrorregiao)

#write.csv()
dado%>%
  knitr::kable(.,"simple")
```
```{r}
cadu%>% dplyr::select(macrorregiao, populacao, cadunico_tot_pes_pob_e_ext_pob)%>%
  group_by(macrorregiao)%>%
  dplyr::summarise_at(c("cadunico_tot_pes_pob_e_ext_pob","populacao"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  sort_desc(percent_pob,macrorregiao) %>%
  knitr::kable(.,"simple")
```

```{r}
cadu%>% dplyr::select(regiao.de.saude, populacao, cadunico_tot_pes_pob_e_ext_pob)%>%
  group_by(regiao.de.saude)%>%
  dplyr::summarise_at(c("cadunico_tot_pes_pob_e_ext_pob","populacao"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  sort_desc(percent_pob,regiao.de.saude) %>%
  knitr::kable(.,"simple")
```


```{r}
bahia_pobres<-cadu%>% dplyr::select(macrorregiao,regiao.de.saude, populacao, cadunico_tot_pes_pob_e_ext_pob,cadunico_tot_pes)%>%
  group_by(macrorregiao,regiao.de.saude)%>%
  dplyr::summarise_at(c("cadunico_tot_pes_pob_e_ext_pob", "cadunico_tot_pes", "populacao"), sum, na.rm = TRUE)%>%
  mutate(percent_pob= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  mutate(pes_cadu= round((cadunico_tot_pes/populacao)*100,3))%>% # por ha
  sort_desc(percent_pob,pes_cadu,macrorregiao)

save(bahia_pobres, file = "/cloud/project/binomial/bases finais/bahia_pobres.RData")

bahia_pobres %>%
  knitr::kable(.,"simple")


```

```{r}
p<-bahia_pobres%>%dplyr::rename(percentual_pobres=percent_pob)%>%
ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size=percentual_pobres)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 4))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/cadu_pobre.jpg")

```

```{r}
data<-bahia_pobres%>%dplyr::select(macrorregiao,populacao,cadunico_tot_pes_pob_e_ext_pob)%>%
 group_by(macrorregiao)%>%
  dplyr::summarise_at(c("cadunico_tot_pes_pob_e_ext_pob", "populacao"), sum, na.rm = TRUE)%>%
  mutate(pecentual_pobres= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  sort_desc(cadunico_tot_pes_pob_e_ext_pob,macrorregiao)%>%
  dplyr::arrange(macrorregiao)

p<- ggplot(data, aes(x = macrorregiao, y = cadunico_tot_pes_pob_e_ext_pob)) +
  geom_bar(stat = "identity")

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

```



```{r}
data<-bahia_pobres%>%dplyr::select(macrorregiao,populacao,cadunico_tot_pes_pob_e_ext_pob)%>%
 group_by(macrorregiao)%>%
  dplyr::summarise_at(c("cadunico_tot_pes_pob_e_ext_pob", "populacao"), sum, na.rm = TRUE)%>%
  mutate(pecentual_pobres= round((cadunico_tot_pes_pob_e_ext_pob/populacao)*100,3))%>% # por ha
  sort_desc(pecentual_pobres,macrorregiao)%>%
  dplyr::arrange(macrorregiao)

p<- ggplot(data, aes(x = macrorregiao, y = pecentual_pobres)) +
  geom_bar(stat = "identity")

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/percentpob_macro.jpg")
```


```{r}
data<-bahia_pobres%>%dplyr::select(macrorregiao,populacao,cadunico_tot_pes)%>%
 group_by(macrorregiao)%>%
  dplyr::summarise_at(c("cadunico_tot_pes", "populacao"), sum, na.rm = TRUE)%>%
  mutate(percent_cadu= round((cadunico_tot_pes/populacao)*100,3))%>% # por ha
  sort_desc(percent_cadu,macrorregiao)%>%
  dplyr::arrange(macrorregiao)

p<-ggplot(data, aes(x = macrorregiao, y = percent_cadu)) +
  geom_bar(stat = "identity")

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))

# save the file with exaggerated width (just an example)
ggsave("/cloud/project/binomial/bases finais/percentcadu_macro.jpg")

```
```{r}
dt<-cadu%>% dplyr::filter(ano==2016)%>%dplyr::select(macrorregiao,populacao,cadu_Ssnis_2015)%>%
  group_by(macrorregiao)%>%
 mutate(cadu_Ssnis= round((cadu_Ssnis_2015*100),3))%>% # por ha
 dplyr::summarise_at(c("cadu_Ssnis"), sum, na.rm = TRUE)%>%
  sort_desc(cadu_Ssnis, macrorregiao)


p<-ggplot(dt, aes(x = macrorregiao, y = cadu_Ssnis)) +
  geom_bar(stat = "identity")

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 5))
ggsave("/cloud/project/binomial/bases finais/snis_macro.jpg")
```
```{r}
#library(Rmisc)
#summarySE(dt, measurevar="cadunico_tot_pes", groupvars=c("ano"))
cadu%>% dplyr::filter(ano==2016)%>%dplyr::select(cadu_Ssnis_2015)%>%
 mutate(cadu_Ssnis= round((cadu_Ssnis_2015*100),3))%>% # por ha
 dplyr::summarise_at(c("cadu_Ssnis"), sum, na.rm = TRUE)

```
```{r}
cadu%>% dplyr::filter(ano==2016)%>%dplyr::select(populacao)%>%
 dplyr::summarise_at(c("populacao"), sum, na.rm = TRUE)
```
```{r}
1112414*100/15203869
```

Percentual cadu snis ano 2015

```{r}
library(readr)
bahia_2015 <- read_delim("/cloud/project/bases usadas/tabnet_bahia_2015.csv", 
    delim = ";", escape_double = FALSE, trim_ws = TRUE)

```

```{r}
snis_2015<-cadu_ba_16_19_12%>%dplyr::filter(ano==2016)%>%dplyr::select(ibge,mun)%>%
  left_join(bahia_2015 %>%
  dplyr::select(ibge_6,pop_2015),by = c('ibge' = 'ibge_6'))%>%
  left_join(bahia_pop_long%>%dplyr::filter(ano==2016)%>%dplyr::select(mun,macrorregiao,regiao.de.saude, cadu_Ssnis_2015), by = c('mun' = 'mun'))%>%
  mutate(cadu_Ssnis= round(((cadu_Ssnis_2015*pop_2015)/100),3))# retiro percentual e deixo em contagem.

save(snis_2015, file = "/cloud/project/binomial/bases finais/bahia_cadu_snis_2015.RData")
```


```{r}
cadu_snis_2015<-snis_2015%>%dplyr::select(macrorregiao,pop_2015,cadu_Ssnis)%>%
 group_by(macrorregiao)%>%
 dplyr::summarise_at(c("cadu_Ssnis","pop_2015"), sum, na.rm = TRUE)%>%
 mutate(percent_Ssnis= round(((cadu_Ssnis/pop_2015)*100),3))%>%# percentual
 sort_desc(percent_Ssnis,macrorregiao)

cadu_snis_2015%>%
  knitr::kable(.,"simple")

```

```{r}
snis<-snis_2015%>%dplyr::select(macrorregiao,regiao.de.saude,pop_2015,cadu_Ssnis)%>%
 group_by(macrorregiao,regiao.de.saude)%>%
 dplyr::summarise_at(c("cadu_Ssnis","pop_2015"), sum, na.rm = TRUE)%>%
 mutate(percent_Ssnis= round(((cadu_Ssnis/(pop_2015-1))*100),3))%>%# percentual
 sort_desc(macrorregiao, regiao.de.saude,percent_Ssnis)

p<-snis%>%
ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size=percent_Ssnis)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 4))

ggsave("/cloud/project/binomial/bases finais/snis_2015_mers.jpg")

```
G1A
```{r}
load("/cloud/project/bases usadas/var_IBGE_ba.RData")

g1a<-SNIS_ba%>%dplyr::select(mun,ano,populacao,G12A,tx_G12A)%>%
  left_join(bahia_pop_long%>%dplyr::filter(ano==2016)%>%dplyr::select(mun,macrorregiao,regiao.de.saude), by = c('mun' = 'mun'))
  
#save(snis_2015, file = "/cloud/project/binomial/bases finais/bahia_cadu_snis_2015.RData")

```

```{r}
library(Rmisc)
summarySE(g1a, measurevar="G12A", groupvars=c("G12A==0", "ano"))

```

```{r}
g1a%>%dplyr::filter(G12A==0)%>%dplyr::select(ano,macrorregiao,regiao.de.saude,mun)%>%
  group_by(ano, macrorregiao,regiao.de.saude,mun)%>%  
  sort_asc(macrorregiao,ano)%>%
  knitr::kable(.,"simple")
```


```{r}
g1a%>%dplyr::filter(G12A==0)%>%dplyr::select(mun)%>%
  group_by(mun)%>%  
  table()%>%
  knitr::kable(.,"simple")

```


```{r}
g1a%>%dplyr::filter(G12A!=0)%>%dplyr::select(mun,ano,populacao,G12A,tx_G12A)%>%
  sort_asc(tx_G12A,mun)%>%
  knitr::kable(.,"simple")

```

```{r}
g1a%>%dplyr::select(populacao,G12A,ano)%>%
 group_by(ano)%>%  
 dplyr::summarise_at(c("populacao","G12A"), sum, na.rm = TRUE)%>%
 mutate(percent= round(((G12A/populacao)*100),3))

```
```{r}
g1a%>%dplyr::select(populacao,G12A,macrorregiao,regiao.de.saude)%>%
 group_by(macrorregiao,regiao.de.saude)%>%  
 dplyr::summarise_at(c("populacao","G12A"), sum, na.rm = TRUE)%>%
 mutate(percent= round(((G12A/populacao)*100),3))%>%
 sort_asc(percent,macrorregiao, regiao.de.saude)%>%
  knitr::kable(.,"simple")

```


```{r}
x<-g1a%>%dplyr::select(macrorregiao,regiao.de.saude,G12A,tx_G12A)%>%
  sort_asc(tx_G12A,macrorregiao,regiao.de.saude)

p<-x%>%
ggplot(aes(x = macrorregiao,
             y = regiao.de.saude, 
             size=tx_G12A)) +
  geom_point()

p + 
  theme_bw() + 
  theme(axis.ticks.length = unit(-0.25, "cm"), 
        axis.ticks.margin = unit(0.5, "cm"))+
  theme(axis.title = element_text(size = 10),
        axis.text = element_text(size = 4))

ggsave("/cloud/project/binomial/bases finais/g12a_mers.jpg")

```


```{r}
# Base indicadores
indicadores_ba<-g1a%>%
   left_join(snis_2015%>%dplyr::select(-4,-5), by = c('mun' = 'mun'))%>%
   left_join(cadu_ba_16_19_12%>%dplyr::select(-1,-4), by = c('mun' = 'mun','ano' = 'ano' ))
save(indicadores_ba, file = "/cloud/project/binomial/bases finais/indicadores_ba.RData")
```


```{r}

```

